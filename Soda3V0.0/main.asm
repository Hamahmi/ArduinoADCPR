;
; Soda3V0.0.asm
;
; Created: 09-Nov-18 4:32:38 PM
; Author : Soda3 Mn Kotr El 3azama
;

;		A		B		C
; PIN	20		23		26
; DDR	21		24		27
; PORT	22		25		28

; ADCSRA	7A
; ADMUX		7C
; ADCL		78
; ADCH		79



; VALUES
;	PORTC 7 -> D31
;	PORTB 7 -> INTERNAL LED
;	

; Replace with your application code
/* LDI R16, 0Xff
STS 0x21, r16 ; DDRA 
STS 0x24, r16 ; DDRB
*/

LDI R16 , 0xFF
STS 0x27, R16	; DDRC	C OUTPUT  FOR LED
STS 0x24, R16	; DDRB B OUTPUT FOR INTERNAL LED
LDI R16 , 0x00		
STS 0x21, R16	; DDRA	A INPUT   FOR ANALOG PR 
LDI R16 , 0x87	
STS 0x7A, R16	; ADCSRA	ENABLE ADC AND CLK/128
LDI R16 , 0xC0
STS 0x7C, R16	; ADMUX		2.56 VREF, ADC0 SIGNAL ENDED INPUT, ADCH[1,0]:ADCL



READ_ADC:
	LDS	R16, 0x7A ; ADCSRA									// SBI ADCSRA, ADSC
	SBR R16, 0b01000000										// SBI ADCSRA, ADSC
	STS 0x7A, R16	; ADSC		START CONVERSION			// SBI ADCSRA, ADSC

	KEEP_POLING :
		LDS R16 ,0x7A	;									//	SBIS ADCSRA, ADIF  
		SBRS R16, 4		; ADIF	WAIT TILL CONVERSION ENDS	//	SBIS ADCSRA, ADIF
		JMP KEEP_POLING
	LDS R16, 0x7A											// SBI ADCSRA, 4
	SBR R16, 0b00010000												// SBI ADCSRA, 4
	STS 0x7A, R16		; ADIF	CLEAR ADIF FLAG				// SBI ADCSRA, 4
	
	LDS R16 , 0x78	; ADCL		READ ADCL
	// TODO
	LDS R16 , 0x79	; ADCH		READ ADCH
	SBRS R16 , 0
	JMP ZERO
	JMP ONE

	
	
ZERO :
	SBI PORTC , 7 
	CBI PORTB , 7
	JMP READ_ADC	; KEEP READING

ONE : 
	CBI PORTC , 7
	SBI PORTB , 7		; internal
	JMP READ_ADC	; KEEP READING